/*
 This file is part of Cuidando Bem.

 Cuidando Bem is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 Cuidando Bem is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with Cuidando Bem.  If not, see <http://www.gnu.org/licenses/>.
 */

define(["text!../html/dialog/dialog.html","text!../html/dialog/dialogButtonTemplate.html"],function(e,a){function o(a){$(a).append(e)}function n(e){x?t(e):s(e)}function s(e){dialog=e,$(f).show(),$(g).show("fade",{duration:200,complete:function(){t(e)}}),x=!0}function t(e){if($(h).text(e.getSpeakerName()),$(m).removeClass(),$(m).addClass(e.getSpeakerCssClass()),$(m).show(),$(b).text(e.getText()),$("#accessible_log").empty(),$("<span>"+e.getSpeakerName()+": </span>").appendTo("#accessible_log"),""!=e.getText()&&$("<span>"+e.getText()+"</span><br>").appendTo("#accessible_log"),i(e.getOptions(),e.getRandomize()),$("<span>Pressione a seta para cima para reler.</span><br>").appendTo("#accessible_log"),""!=$(".dialog_mainText").text())$("<span>Pressione a seta para baixo para avançar.</span><br>").appendTo("#accessible_log");else if(""!=$(".dialog_options").text()){var a=$(".dialog_options .text").map(function(){return $.trim($(this).text())}).get();1==a.length?$("<span>Pressione o número 1 para selecionar a opção única.</span><br>").appendTo("#accessible_log"):$("<span>Pressione os números 1, 2 ou 3 para selecionar as opções 1, 2 ou 3, respectivamente.</span><br>").appendTo("#accessible_log")}$(".dialog_reread").off(),$(".dialog_reread").click(function(){if($("#accessible_log").empty(),$("<span>"+$(".dialog_charName").text()+": </span>").appendTo("#accessible_log"),""!=$(".dialog_mainText").text())$("<span>"+$(".dialog_mainText").text()+"</span><br>").appendTo("#accessible_log"),$("<span>Pressione a seta para cima para reler.</span><br>").appendTo("#accessible_log"),$("<span>Pressione a seta para baixo para avançar.</span><br>").appendTo("#accessible_log");else if(""!=$(".dialog_options").text()){for(var e=$(".dialog_options .text").map(function(){return $.trim($(this).text())}).get(),a=0;a<e.length;a++)1==e.length?op="única":op=a+1,$("<span>Opção "+op+": "+e[a]+"</span><br>").appendTo("#accessible_log");$("<span>Pressione a seta para cima para reler.</span><br>").appendTo("#accessible_log"),"única"==op?$("<span>Pressione o número 1 para selecionar a opção única.</span><br>").appendTo("#accessible_log"):$("<span>Pressione os números 1, 2 ou 3 para selecionar as opções 1, 2 ou 3, respectivamente.</span><br>").appendTo("#accessible_log")}});0==x?($(g+" div").hide(),$(h).first().show(),$(m).show(),$(b).show(),$(_).show()):($(b).hide(),$(_).hide(),$(h).first().show(),$(m).show(),$(b).show(),$(_).show())}function i(e,a){if(d(),1==e.length&&""==e[0].text){var o=$(u);o.click(e[0].actionFunction),o.on(),$(u).removeClass("off"),$(u).addClass("on"),$(u).append(o)}else c(e,a)}function p(){$(h).hide(),$(m).hide(),$(b).hide(),$(_).hide(),$(f).hide(),$(g).hide("fade",200),x=!1,$(document).unbind("keydown")}function r(e,o){var n=$(a);n.click(e.actionFunction),$(".text",n).text(e.text),$(n).attr("value",o),$(_).append(n)}function l(e){for(var a,o,n=e.length;n;)o=Math.floor(Math.random()*n--),a=e[n],e[n]=e[o],e[o]=a;return e}function c(e,a){var o,n;for(a&&(e=l(e)),o=0;o<e.length;o++)r(e[o],o+1),n=1==e.length?"única":o+1,$("<span>Opção "+n+": "+e[o].text+"</span><br>").appendTo("#accessible_log")}function d(){$(_).empty(),$(u).empty(),$(u).off(),$(u).removeClass("on"),$(u).addClass("off")}var g="#dialogBar",h=".dialog_charName",m="#dialog_charImg",f="#dialogBar-mask",b=".dialog_mainText",_=".dialog_options",u=".dialog_right",x=!1;return{init:o,show:n,close:p}});