define(["text!../assets/html/dialog/dialog.html","text!../assets/html/dialog/dialogButtonTemplate.html"],function(e,t){function f(t){$(t).append(e)}function l(e){a?h(e):c(e)}function c(e){dialog=e,$("#dialogBar-mask").show(),$(n).show("fade",{duration:200,complete:function(){h(e)}}),a=!0}function h(e){function l(){$(r).first().show(t,{duration:f,progress:function(){$(i.show(t))},complete:function(){e.getText()!=""?$(s).show(u,{duration:f,complete:function(){$(o).show(u)}}):$(o).show(u)}})}$(r).text(e.getSpeakerName()),$(i).removeClass(),$(i).addClass(e.getSpeakerCssClass()),$(i).show(),$(s).text(e.getText()),p(e.getOptions(),e.getRandomize());var t="blind",u="clip",f=250;a==0?($(n+" div").hide(),l()):($(s).hide(),$(o).hide(),l())}function p(e,t){E();if(e.length==1&&e[0].text==""){var n=$(u);n.click(e[0].actionFunction),n.on(),$(u).removeClass("off"),$(u).addClass("on"),$(u).append(n)}else b(e,t)}function d(){$(r).hide(),$(i).hide(),$(s).hide(),$(o).hide(),$("#dialogBar-mask").hide(),$(n).hide("fade",200),a=!1}function v(){}function m(){}function g(e){var n=$(t);n.click(e.actionFunction),$(".text",n).text(e.text),$(o).append(n)}function y(e){var t=e.length,n,r;while(t)r=Math.floor(Math.random()*t--),n=e[t],e[t]=e[r],e[r]=n;return e}function b(e,t){var n;t&&(e=y(e));for(n=0;n<e.length;n++)g(e[n])}function w(e){$("."+e.getCssClass(),element).remove()}function E(){$(o).empty(),$(u).empty(),$(u).off(),$(u).removeClass("on"),$(u).addClass("off")}var n="#dialogBar",r=".dialog_charName",i="#dialog_charImg",s=".dialog_mainText",o=".dialog_options",u=".dialog_right",a=!1;return{init:f,show:l,close:d}});