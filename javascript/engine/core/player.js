define(["Sounds","SaveLoadGame"],function(){function C(t,n){for(audio in t)if(typeof t[audio]=="object")t[audio]instanceof Array?n[audio]=[]:n[audio]={},C(t[audio],n[audio]);else{var r=t[audio],i=r.split("."),s=i[0],o=i[1];n[audio]=new Audio(e.baseDir+r),sound=n[audio],sound.loop=!1,sound.volume=e.masterVolume,sound.vol=sound.volume,sound.load()}}function k(e){var t=[];if(typeof e=="object")if(e instanceof Array)t=t.concat(e);else for(x in e)t=t.concat(k(e[x]));else t.push(e);return t}function L(e){var t=k(e),n=Math.floor(Math.random()*t.length),r=t[n];O(r)}function A(e){window.chrome?e.load():e.currentTime=0}function O(e){o=e,A(o),o.play()}function M(e){e.play()}function _(){o.pause()}function D(e,t){return e++,e>=t&&(e=0),e}function P(e){l||(a=k(e),l=!0,f=0,c=a[f],h=new Audio(a[D(f,a.length)].getAttribute("src")),h.volume=a[D(f,a.length)].vol,A(h),p=c,d=setInterval(j,4),O(c))}function H(){l&&(l=!1,c.pause(),clearInterval(d))}function B(){f=D(f,a.length),p!==undefined&&clearInterval(d),p=c,c=h,delete h,h=new Audio(a[f].getAttribute("src")),h.volume=a[f].volume,A(h),M(c),l&&(d=setInterval(j,4))}function j(){var e=c.currentTime*100/c.duration;e>=T&&B()}function F(e){y||(v=k(e),y=!0,q())}function I(){y&&(y=!1,b.pause())}function q(){var e=[];for(i in v)e.push(i);g=m,g!==undefined&&e.splice(g,1),m=e[Math.floor(Math.random()*e.length)],p!==undefined&&(p.pause(),p.removeEventListener("timeupdate",R,!1)),E=b,b=v[m],O(b),y&&b.addEventListener("timeupdate",R,!1)}function R(){var e=this.currentTime*100/this.duration;e>=N&&q()}function U(e,t){var n=k(e);for(soundId in n){var i=n[soundId];i.vol=t,i.volume=t*r}}function z(){var e=k(S);for(soundId in e){var t=e[soundId];t.volume=t.vol*r}}function W(e){r=e,z()}function X(){t.toggleMute(),n=!n,V()}function V(){n?(s=r,W(0)):W(s)}function $(){_(),H(),I()}var e=require("Sounds"),t=require("SaveLoadGame"),n=t.isMuted(),r=e.masterVolume,s,o=undefined,u=undefined,a,f,l=!1,c=undefined,h=undefined,p=undefined,d,v,m,g,y=!1,b=undefined,w=undefined,E=undefined,S={},T=99.9,N=98.5;return C(e.paths,S),n&&V(),{audios:S,play:L,stop:_,mute:X,setVolumeOfTo:U,setMasterVolumeTo:W,playInLoop:P,stopLoop:H,playInRange:F,stopRange:I,stopAll:$}});