/*
 This file is part of Cuidando Bem.

 Cuidando Bem is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 Cuidando Bem is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with Cuidando Bem.  If not, see <http://www.gnu.org/licenses/>.
 */

define(["text!../html/pulseira/pulseira.html"],function(e){function i(i){$(i).append(e)}function a(){return $("#pauseMenu").is(":visible")?(A=$("#pauseMenu .button"),"pause"):$("#commandBar").is(":visible")?(A=$.merge($("#pulseira_modal input:enabled"),$("#commandBar .action_button[class!='disabled']:visible")),"inputsAndActions"):(A=$("#pulseira_modal input:enabled"),"inputsOnly")}function n(e){return op=a(),e==M||e==O?(G>=A.length-1?G=0:G++,$(A[G]).hasClass("action_button")?$(A[G]).trigger("screenReader"):$(A[G]).focus(),!1):e==E?(G>0?G--:G=A.length-1,$(A[G]).hasClass("action_button")?$(A[G]).trigger("screenReader"):$(A[G]).focus(),!1):e==S?($(A[G]).hasClass("action_button")&&$(A[G]).click(),!1):$("#pauseButton").is(":visible")&&e==j?($("#pauseButton").click(),!1):void 0}function t(){$(window).off("keydown"),$(window).on("keydown",function(e){return!$("#dialogBar").is(":visible")||$("#pauseMenu").is(":visible")?n(e.which):e.which==E&&$(".dialog_reread").is(":visible")?($(".dialog_reread").click(),!1):e.which==M&&$(".dialog_right").is(":visible")?($(".dialog_right").click(),!1):e.which==q&&$(".dialog_button[value='1']").is(":visible")?($(".dialog_button[value='1']").click(),!1):e.which==z&&$(".dialog_button[value='2']").is(":visible")?($(".dialog_button[value='2']").click(),!1):e.which==F&&$(".dialog_button[value='3']").is(":visible")?($(".dialog_button[value='3']").click(),!1):$("#pauseButton").is(":visible")&&e.which==j?($("#pauseButton").click(),!1):void 0})}function s(){V=!0,$(y).show(),$(R).mask("00/00/0000");var e=$(R).val().toLowerCase(),i=$(T).val().toLowerCase(),a=$(B).val().toLowerCase();$(R).focus(function(){$("#accessible_log").empty(),$("<span>Data de nascimento: "+e+".</span><br>").appendTo("#accessible_log")}),$(T).focus(function(){$("#accessible_log").empty(),$("<span>Leito: "+i+".</span><br>").appendTo("#accessible_log")}),$(B).focus(function(){$("#accessible_log").empty(),$("<span>Nome: "+a+".</span><br>").appendTo("#accessible_log")}),$("#pulseira_modal input:first").is(":enabled")?$("#pulseira_modal input:first").focus():($("#accessible_log").empty(),$("<span>Nome: "+a+".</span><br>").appendTo("#accessible_log"),$("<span>Leito: "+i+".</span><br>").appendTo("#accessible_log"),$("<span>Data de nascimento: "+e+".</span><br>").appendTo("#accessible_log")),t()}function o(){V=!1,$(y).hide()}function l(){l=!0,$(R).prop("disabled",!0),$(T).prop("disabled",!0),$(B).prop("disabled",!0)}function u(){l=!1,$(R).prop("disabled",!1),$(T).prop("disabled",!1),$(B).prop("disabled",!1)}function c(){return V}function r(){return D}function p(){return x}function d(){return N}function b(){var e=!0,i=$(R).val().toLowerCase(),a=$(T).val().toLowerCase(),n=$(B).val().toLowerCase();return e=e&&k.test(n),e=e&&L.test(a),e=e&&C.test(i)}function f(e){return k=e,this}function g(e){$(B).val(e)}function v(e){return C=e,this}function _(e){$(R).val(e)}function h(e){return L=e,this}function m(e){$(T).val(e)}function w(){g(""),m(""),_(""),u()}var k,L,C,y="#pulseira_modal",B="#name_input",D=!1,T="#leito_input",N=!1,R="#data_input",x=!1,V=!1,A=null;const E=38,M=40,O=9,S=13,j=27,q=49,z=50,F=51;var G=0;return{init:i,close:o,open:s,disable:l,enable:u,isShowing:c,isNameValid:r,isDataValid:p,isLeitoValid:d,isAllDataValid:b,resetData:w,setNameRegExp:f,setDataRegExp:v,setLeitoRegExp:h,setName:g,setLeito:m,setData:_}});