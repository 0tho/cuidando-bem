/*
This file is part of Cuidando Bem.

    Cuidando Bem is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Cuidando Bem is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Cuidando Bem.  If not, see <http://www.gnu.org/licenses/>.
*/

define(["text!../html/prontuario/prontuario.html"],function(t){function e(){return Q}function a(){return U}function o(){return Y}function i(){return Z}function r(){return tt}function c(){return et}function n(){return at}function s(){return ot}function l(){return it}function d(){return rt}function u(){return ct}function f(){return nt}function p(){return $t}function x(){return ft}function w(){return pt}function _(){return xt}function h(t){Q=t,$(_t).text(Q)}function v(t){U=t,$(ht).text(U)}function g(t){Y=t,$(vt).text(Y)}function m(t){Z=t,$(gt).text(Z)}function k(t){tt=t,$(mt).text(tt)}function b(t){et=t,$(kt).text(et)}function E(t){at=t,$(bt).text(at)}function X(t){ot=t,$(Et).text(ot)}function D(t){it=t,$(Xt).text(it)}function A(t){rt=t,$(Dt).text(rt)}function P(t){ct=t,$(At).text(ct)}function R(t){nt=t,$(Pt).text(nt)}function S(t){$t=t,$(Rt).text($t)}function y(t,e){dt=t,t?($(St).text(Ct),$(qt).text(Nt),st=e,$(It).val(e),$(It).show()):($(St).text(Nt),$(qt).text(Ct),$(It).hide())}function I(t){Tt=t,$(It).prop("disabled",Tt)}function M(t){ft=t,$(Vt).text(ft)}function q(t){pt=t,$(Wt).text(pt)}function N(t){xt=t,$(Ht).text(xt)}function C(t,e,a,o,i,r,c,n){if(n=n||!1,0>t||t>_e.length)throw new Error("Invalid row index");_e[t].disabled=n,_e[t].data=e,_e[t].pa=a,_e[t].fc=o,_e[t].fr=i,_e[t].sat=r,_e[t].temp=c,$($(de,le)[t]).text(e),$($(ue,le)[t]).val(a),$($(fe,le)[t]).val(o),$($(pe,le)[t]).val(i),$($(xe,le)[t]).val(r),$($(we,le)[t]).val(c),$($(ue,le)[t]).prop("disabled",n),$($(fe,le)[t]).prop("disabled",n),$($(pe,le)[t]).prop("disabled",n),$($(xe,le)[t]).prop("disabled",n),$($(we,le)[t]).prop("disabled",n)}function T(t,e,a,o,i,r,c){if(0>t||t>_e.length)throw new Error("Invalid row index");he[t].pa=a,he[t].fc=o,he[t].fr=i,he[t].sat=r,he[t].temp=c}function V(t,e){ke=t,Ee=e,$($(ge,ve)[0]).val(t),$($(me,ve)[0]).text(e)}function W(t){var e=$($(me,ve)[0]).text();$($(me,ve)[0]).text(e+t)}function H(t,e){be=t,Xe=e}function L(t,e,a,o,i,r,c,n){if(0>t||t>Jt.length)throw new Error("Invalid row index");Jt[t].disabled=n,Jt[t].data=e,Jt[t].medicacao=a,Jt[t].via=o,Jt[t].posologia=i,Jt[t].horario=r,Jt[t].relatorio=c,$($(Ot,Lt)[t]).text(e),$($(zt,Lt)[t]).text(a),$($(jt,Lt)[t]).text(o),$($(Bt,Lt)[t]).text(i),$($(Ft,Lt)[t]).text(r),Jt[t].relatorio?$($(Gt,Lt)[t]).text("(x)"):$($(Gt,Lt)[t]).text("( )"),n&&$($(Gt,Lt)[t]).addClass("disabled")}function O(t,e){if(0>t||t>Jt.length)throw new Error("Invalid row index");Kt[t]=e}function z(t){$("tr",se).hide();var e;$.each(Qt,function(t,e){Qt[t]=!1}),t.forEach(function(t){prescEnfermagemState=t,Qt[prescEnfermagemState]=!0,$("."+prescEnfermagemState,se).show()}),e=$(".decubito",se),Ut=[!1,!1,!1],$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.decubito&&$(".opcao",e).click({container:e},function(t){e=t.data.container;var a=$(".opcao",e).index(this);Ut=[!1,!1,!1],Ut[a]=!0,$(".check",e).text("( )"),$($(".check",e)[a]).text("(X)")}),e=$(".verificar_glicemia",se),Yt=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.verificar_glicemia&&$(".opcao",e).click({container:e},function(t){e=t.data.container,Yt=!Yt,Yt?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".verificar_glicemia2",se),Zt=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.verificar_glicemia2&&$(".opcao",e).click({container:e},function(t){e=t.data.container,Zt=!Zt,Zt?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".levantar_grade",se),te=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.levantar_grade&&$(".opcao",e).click({container:e},function(t){e=t.data.container,te=!te,te?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".encaminhar_paciente_cc",se),ee=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.encaminhar_paciente_cc&&$(".opcao",e).click({container:e},function(t){e=t.data.container,ee=!ee,ee?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".check_list_cirurgia",se),ae=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.check_list_cirurgia&&$(".opcao",e).click({container:e},function(t){e=t.data.container,ae=!ae,ae?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".placa_neutra",se),oe=[!1,!1,!1],$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.placa_neutra&&$(".opcao",e).click({container:e},function(t){e=t.data.container;var a=$(".opcao",e).index(this);oe=[!1,!1,!1],oe[a]=!0,$(".check",e).text("( )"),$($(".check",e)[a]).text("(X)")}),e=$(".placa_neutra2",se),ie=[!1,!1,!1],$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.placa_neutra2&&$(".opcao",e).click({container:e},function(t){e=t.data.container;var a=$(".opcao",e).index(this);ie=[!1,!1,!1],ie[a]=!0,$(".check",e).text("( )"),$($(".check",e)[a]).text("(X)")}),e=$(".risco_infeccao",se),re=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.risco_infeccao&&$(".opcao",e).click({container:e},function(t){e=t.data.container,re=!re,re?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".troca_curativo",se),ce=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.troca_curativo&&$(".opcao",e).click({container:e},function(t){e=t.data.container,ce=!ce,ce?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".nutricao_desequilibrada",se),ne=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.nutricao_desequilibrada&&$(".opcao",e).click({container:e},function(t){e=t.data.container,ne=!ne,ne?$(".check",e).text("(X)"):$(".check",e).text("( )")}),e=$(".manutencao_sonda_nasogastrica",se),$e=!1,$(".check",e).text("( )"),$(".opcao",e).unbind("click"),Qt.manutencao_sonda_nasogastrica&&$(".opcao",e).click({container:e},function(t){e=t.data.container,$e=!$e,$e?$(".check",e).text("(X)"):$(".check",e).text("( )")})}function j(e){$(e).append(t),$(yt).click(function(){Tt||(dt=!0,$(St).text("X"),$(qt).text("   "),$(It).show())}),$(Mt).click(function(){Tt||(dt=!1,$(qt).text("X"),$(St).text("   "),$(It).hide())}),$(Gt,Lt).click(function(){var t=$(Gt,Lt).index(this);Jt[t].disabled||(Jt[t].relatorio=!Jt[t].relatorio,Jt[t].relatorio?$(this).text("(x)"):$(this).text("( )"))}),$(".content").tabs()}function B(t){for($(wt).show(),row=0;row<_e.length;row++){_e[row].disabled;$($(ue,le)[row]).mask("000x000"),$($(fe,le)[row]).mask("000"),$($(pe,le)[row]).mask("000"),$($(xe,le)[row]).mask("000"),$($(we,le)[row]).mask("00.0")}F();var e=0;switch(t){case"internacao":e=1;break;case"prescMedica":e=2;break;case"prescEnfermagem":e=3;break;case"sinaisVitais":e=4;break;case"anotacoes":e=5;break;case"paciente":default:e=0}$(".content").tabs("option","active",e);var a=0;$(document).keydown(function(t){if($(".action_button:visible").length)var e=$.merge($("#prontuario li.ui-state-default:visible a"),$(".action_button:visible"));else var e=$("#prontuario li.ui-state-default:visible a");0!=e.length&&(40==t.which?(a>=e.length-1?a=0:a++,$(e[a]).focus(),$("<span>"+a+"</span><br>").appendTo("#testWelly")):38==t.which?(a>0?a--:a=e.length-1,$(e[a]).focus(),$("<span>"+a+"</span><br>").appendTo("#testWelly")):13==t.which&&($("<span>"+a+"</span><br>").appendTo("#testWelly"),-1!=a&&($(e[a]).click(),showing=!1)))})}function F(){for($(_t).text(Q),$(ht).text(U),$(vt).text(Y),$(gt).text(Z),$(mt).text(tt),$(kt).text(et),$(bt).text(at),$(Et).text(ot),$(Xt).text(it),$(Dt).text(rt),$(At).text(ct),$(Pt).text(nt),$(Rt).text($t),$(Vt).text(ft),$(Wt).text(pt),$(Ht).text(xt),$(It).prop("disabled",Tt),dt?($(St).text(Ct),$(qt).text(Nt),$(It).val(st),$(It).show()):($(St).text(Nt),$(qt).text(Ct),$(It).hide()),row=0;row<Jt.length;row++)$($(Ot,Lt)[row]).text(Jt[row].data),$($(zt,Lt)[row]).text(Jt[row].medicacao),$($(jt,Lt)[row]).text(Jt[row].via),$($(Bt,Lt)[row]).text(Jt[row].posologia),$($(Ft,Lt)[row]).text(Jt[row].horario),Jt[row].relatorio?$($(Gt,Lt)[row]).text("(x)"):$($(Gt,Lt)[row]).text("( )");for(row=0;row<_e.length;row++){var t=_e[row].disabled;$($(de,le)[row]).text(_e[row].data),$($(ue,le)[row]).val(_e[row].pa),$($(fe,le)[row]).val(_e[row].fc),$($(pe,le)[row]).val(_e[row].fr),$($(xe,le)[row]).val(_e[row].sat),$($(we,le)[row]).val(_e[row].temp),$($(ue,le)[row]).prop("disabled",t),$($(fe,le)[row]).prop("disabled",t),$($(pe,le)[row]).prop("disabled",t),$($(xe,le)[row]).prop("disabled",t),$($(we,le)[row]).prop("disabled",t)}$($(ge,ve)[0]).val(ke),$($(me,ve)[0]).val(Ee)}function G(){for(Q=$(_t).text(),U=$(ht).text(),Y=$(vt).text(),Z=$(gt).text(),tt=$(mt).text(),et=$(kt).text(),at=$(bt).text(),ot=$(Et).text(),it=$(Xt).text(),rt=$(Dt).text(),ct=$(At).text(),nt=$(Pt).text(),$t=$(Rt).text(),ft=$(Vt).text(),pt=$(Wt).text(),xt=$(Ht).text(),row=0;row<Jt.length;row++)Jt[row].data=$($(Ot,Lt)[row]).text(),Jt[row].medicacao=$($(zt,Lt)[row]).text(),Jt[row].via=$($(jt,Lt)[row]).text(),Jt[row].posologia=$($(Bt,Lt)[row]).text(),Jt[row].horario=$($(Ft,Lt)[row]).text();for(row=0;row<_e.length;row++){_e[row].disabled;_e[row].data=$($(de,le)[row]).text(),_e[row].pa=$($(ue,le)[row]).val(),_e[row].fc=$($(fe,le)[row]).val(),_e[row].fr=$($(pe,le)[row]).val(),_e[row].sat=$($(xe,le)[row]).val(),_e[row].temp=$($(we,le)[row]).val()}ke=$($(ge,ve)[0]).val(),Ee=$($(me,ve)[0]).val()}function J(){G(),$(wt).hide()}function K(){var t;if(!Tt){if(ut!=dt)return!1;if(dt&&!lt.test(st))return!1}for(t=0;t<Jt.length;t++)if(!Jt[t].disabled&&!Jt[t].relatorio)return!1;if(Qt.decubito&&!Ut[1])return!1;if(Qt.verificar_glicemia&&!Yt)return!1;if(Qt.verificar_glicemia2&&!Zt)return!1;if(Qt.levantar_grade&&!te)return!1;if(Qt.encaminhar_paciente_cc&&!ee)return!1;if(Qt.check_list_cirurgia&&!ae)return!1;if(Qt.placa_neutra&&!oe[1])return!1;if(Qt.placa_neutra2&&!ie[0])return!1;if(Qt.risco_infeccao&&!re)return!1;if(Qt.troca_curativo&&!ce)return!1;if(Qt.nutricao_desequilibrada&&!ne)return!1;if(Qt.manutencao_sonda_nasogastrica&&!$e)return!1;for(t=0;t<_e.length;t++)if(!_e[t].disabled){if(pa=$($(ue,le)[t]).val(),fc=$($(fe,le)[t]).val(),fr=$($(pe,le)[t]).val(),sat=$($(xe,le)[t]).val(),temp=$($(we,le)[t]).val(),!he[t].pa.test(pa))return!1;if(!he[t].fc.test(fc))return!1;if(!he[t].fr.test(fr))return!1;if(!he[t].sat.test(sat))return!1;if(!he[t].temp.test(temp))return!1}return!0}var Q,U,Y,Z,tt,et,at,ot,it,rt,ct,nt,$t,st,lt,dt,ut,ft,pt,xt,wt="#prontuario",_t="#pront_nome",ht="#pront_data_nascimento",vt="#pront_idade",gt="#pront_sexo",mt="#pront_estado_civil",kt="#pront_profissao",bt="#pront_nome_pai",Et="#pront_nome_mae",Xt="#pront_data_internacao",Dt="#pront_numero_leito",At="#pront_antecedentes",Pt="#pront_hipotese_diagnostica",Rt="#pront_observacoes",St="#pront_alergia_spanSim",yt="#pront_alergia_divSim",It="#pront_alergia_qual",Mt="#pront_alergia_divNao",qt="#pront_alergia_spanNao",Nt="   ",Ct="X",Tt=!1,Vt="#pront_peso",Wt="#pront_altura",Ht="#pront_circunferencia_abdominal",Lt="#prescMedica_tbody",Ot=".data",zt=".medicacao",jt=".via",Bt=".posologia",Ft=".horario",Gt=".relatorio",Jt=[{disabled:!1,data:"",medicacao:"",via:"",posologia:"",horario:"",relatorio:!1},{disabled:!1,data:"",medicacao:"",via:"",posologia:"",horario:"",relatorio:!1},{disabled:!1,data:"",medicacao:"",via:"",posologia:"",horario:"",relatorio:!1},{disabled:!1,data:"",medicacao:"",via:"",posologia:"",horario:"",relatorio:!1}],Kt=[{relatorio:""},{relatorio:""}],Qt={vazio:!1,decubito:!1,decubito_visual:!1,verificar_glicemia:!1,verificar_glicemia2:!1,verificar_glicemia3:!1,levantar_grade:!1,encaminhar_paciente_cc:!1,check_list_cirurgia:!1,placa_neutra:!1,placa_neutra2:!1,risco_infeccao:!1,troca_curativo:!1,nutricao_desequilibrada:!1,manutencao_sonda_nasogastrica:!1,desiquilibrio_eletrolitico:!1,desiquilibrio_eletrolitico_fase9:!1},Ut=[!1,!1,!1],Yt=!1,Zt=!1,te=!1,ee=!1,ae=!1,oe=[!1,!1,!1],ie=[!1,!1,!1],re=!1,ce=!1,ne=!1,$e=!1,se="#prescEnfermagem_tbody",le="#ssvv_tbody",de=".data",ue=".pa",fe=".fc",pe=".fr",xe=".sat",we=".temp",_e=[{disabled:!1,data:"",pa:"",fc:"",fr:"",sat:"",temp:""},{disabled:!1,data:"",pa:"",fc:"",fr:"",sat:"",temp:""}],he=[{data:"",pa:"",fc:"",fr:"",sat:"",temp:""},{data:"",pa:"",fc:"",fr:"",sat:"",temp:""}],ve="#anotacaoEnfermagem_tbody",ge=".data",me=".anotacao",ke="",be="",Ee="",Xe="";return window.Prontuario={open:B,close:J,isDataValid:K},{init:j,open:B,close:J,isDataValid:K,updateData:F,getNome:e,getDataNascimento:a,getIdade:o,getSexo:i,getEstadoCivil:r,getProfissao:c,getPai:n,getMae:s,getDataInternacao:l,getLeito:d,getAntecedentes:u,getHipotese:f,getObservacoes:p,getPeso:x,getAltura:w,getCircunferenciaAbdominal:_,setNome:h,setDataNascimento:v,setIdade:g,setAlergiaMedicamentosa:y,setDisableAlergiaMedicamentosa:I,setSexo:m,setEstadoCivil:k,setProfissao:b,setPai:E,setMae:X,setDataInternacao:D,setLeito:A,setAntecedentes:P,setHipotese:R,setObservacoes:S,setPeso:M,setAltura:q,setCircunferenciaAbdominal:N,setPrescEnfermagemState:z,addToRelatorio:W,setSsvvRowData:C,setSsvvRowRegExp:T,setAnotacaoEnfermagemRowData:V,setAnotacaoEnfermagemRowRegExp:H,setPrescMedicaRowData:L,setPrescMedicaRowRegExp:O}});